--developed by sravani
use GreatOutdoor
go
/*
created admin table
*/
create table AdminTable
(
AdminID uniqueidentifier primary key,
AdminName varchar(30) not null,
Email varchar(30) unique not null,
Password varchar(15) not null,
CreationDateTime datetime,
LastModifiedDateTime datetime
)
go
/*
created View sales reports table
*/
create table ViewSalesReports
(
SalespersonID varchar(20) primary key,
SalespersonName varchar(30) not null,
OfflinesalesCount int,
TotalAmount money,
Target varchar(10),
LastUpdatedsalestime datetime
)
go


​
--developed by sravani
/*
creating procedure to update admin details
*/
Create procedure UpdateAdmin(@AdminID varchar(30), @AdminName varchar(30),@Email varchAR(30),​
@Password varchar(15),@CreationDateTime datetime, @LastModifiedDateTime datetime)​
AS ​
BEGIN​
begin try​
update AdminTable set AdminName= @AdminName,Email=@Email,LastModifiedDateTime =@LastModifiedDateTime​
where AdminID= @AdminID​
end try​
begin Catch​
throw 500000,'Admin Not Updated',1​
end catch ​
END
/*
alter procedure to update admin details
*/
Alter procedure UpdateAdmin(@AdminID varchar(30), @AdminName varchar(30),@Email varchAR(30),​
@Password varchar(15),@CreationDateTime datetime, @LastModifiedDateTime datetime)​
AS ​
BEGIN​
begin try​
update AdminTable set AdminName= @AdminName,Email=@Email,LastModifiedDateTime =@LastModifiedDateTime​
where AdminID= @AdminID​
end try​
begin Catch​
throw 500000,'Admin Not Updated',1​
end catch ​
END​

/*
creating procedure to update admin Password
*/
Create procedure UpdateAdminPassword(@Email varchar(30),@OldPassword varchar(15),@NewPassword varchar(15))​
AS ​
BEGIN​
begin try​
if exists (select 1 from AdminTable where Email= @Email and Password=@OldPassword )
update AdminTable set Password=@NewPassword​,LastModifiedDateTime=DATETIME.NOW()
where Email=@Email
else throw 500000,'Old password is incorrect',1
end try​
begin Catch​
throw 500000,'Admin password Not Updated',1​
end catch ​
END

/*
Alter Procedure for changing admin password
*/
Alter procedure UpdateAdminPassword(@AdminID varchar(30),@OldPassword varchar(15),@NewPassword varchar(15))​
AS ​
BEGIN​
begin try​
if exists (select 1 from AdminTable where AdminID= @AdminID​ and Password=@OldPassword )
update AdminTable set Password=@NewPassword​,LastModifiedDateTime=DateTIME.NOW()
where AdminID=@AdminID
else throw 500000,'Old password is incorrect',1
end try​
begin Catch​
throw 500000,'Admin password Not Updated',1​
end catch ​
END

/*
created procedure for reading admin details by passing Email Id
*/
create procedure GetAdminbyEmail(@Email varchar(30))
as 
begin
	begin try
		SELECT* FROM AdminTable where Email=@Email
	end try
	begin catch
	PRINT @@ERROR;
		throw 5001,'Invalid Values Fetched',6
		return 0
    end catch
end
GO


/*
created procedure for reading admin details by passing Email Id and Password
*/
create procedure GetAdminbyEmailAndPassword(@Email varchar(30),@Password varchar(15))
as 
begin
	begin try
		SELECT* FROM AdminTable where Email=@Email and Password=@Password
	end try
	begin catch
	PRINT @@ERROR;
		throw 5001,'Invalid Values Fetched',6
		return 0
    end catch
end
GO